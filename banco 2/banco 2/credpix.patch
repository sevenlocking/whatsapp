 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/banco 2/banco 2/ai-chat.js b/banco 2/banco 2/ai-chat.js
index fc1e11ba74bc5abb128df471316a07cde786d9aa..b46f5e7074c91f29891c7fffc4b9b3705212239d 100644
--- a/banco 2/banco 2/ai-chat.js	
+++ b/banco 2/banco 2/ai-chat.js	
@@ -81,51 +81,51 @@ OPERAÃ‡Ã•ES DISPONÃVEIS:
    - Retorne: {"action": "save_contact", "name": "JoÃ£o", "pixKey": "12345678900", "pixKeyType": "cpf"}
 
    LISTAR CONTATOS:
    - Exemplos: "meus contatos", "listar contatos", "ver contatos salvos", "quais contatos tenho?"
    - Retorne imediatamente: {"action": "list_contacts"}
 
    REMOVER CONTATO:
    - Exemplos: "remover contato JoÃ£o", "apagar Maria", "excluir contato fulano"
    - Retorne: {"action": "remove_contact", "name": "JoÃ£o"}
 
 1. GERAR PIX (Receber pagamento / DepÃ³sito):
    - Exemplos: "gerar pix de 50 reais", "quero receber 100", "criar pix de R$ 25,50"
    - TAMBÃ‰M ACEITE: "depositar", "quero depositar", "fazer depÃ³sito", "gerar qrcode", "gere um qrcode"
    - Exemplos adicionais: "depositar 100", "quero depositar 50 reais", "gere um qrcode de 200"
    - VocÃª precisa saber: VALOR
    - Se o valor estiver na mensagem, execute IMEDIATAMENTE
    - Se faltar o valor, pergunte: "Qual o valor do PIX?"
    - Quando tiver o valor, retorne: {"action": "generate_pix", "amount": 5000} (valor em centavos)
 
 2. FAZER SAQUE/TRANSFERÃŠNCIA (Enviar pagamento):
    - Exemplos: "enviar 50 para 11999999999", "envie 10 reais para o cpf 10588767670", "transferir R$ 100 para chave@email.com", "pix de 25 para o telefone 11987654321"
    - ACEITE variaÃ§Ãµes: "enviar", "envie", "envie.", "transferir", "transfere", "mandar", "manda", "pagar"
    - VocÃª precisa saber: VALOR e CHAVE PIX
    - Se AMBOS estiverem na mensagem, execute IMEDIATAMENTE
 
-   - REGRAS DE IDENTIFICAÃ‡ÃƒO DO TIPO DE CHAVE (PayZu usa MINÃšSCULAS!):
+   - REGRAS DE IDENTIFICAÃ‡ÃƒO DO TIPO DE CHAVE (CREDPIX usa MINÃšSCULAS!):
      1. Se o usuÃ¡rio mencionar "cpf", "para o cpf", "pro cpf" â†’ SEMPRE use "cpf"
      2. Se o usuÃ¡rio mencionar "telefone", "phone", "para o telefone", "celular" â†’ SEMPRE use "phone"
      3. Se o usuÃ¡rio mencionar "cnpj", "para o cnpj" â†’ SEMPRE use "cnpj"
      4. Se o usuÃ¡rio mencionar "email", "e-mail", "para o email" â†’ SEMPRE use "email"
      5. Se o usuÃ¡rio mencionar "chave aleatÃ³ria", "aleatÃ³ria", "random", "evp" â†’ SEMPRE use "evp"
      6. Caso contrÃ¡rio, identifique automaticamente PELO FORMATO:
 
         * **CPF FORMATADO** (XXX.XXX.XXX-XX): Se contÃ©m pontos e hÃ­fen no padrÃ£o CPF â†’ "cpf"
           Exemplo: "105.887.676-70" â†’ extraia apenas dÃ­gitos "10588767670" e use "cpf"
 
         * **CNPJ FORMATADO** (XX.XXX.XXX/XXXX-XX): Se contÃ©m pontos, barra e hÃ­fen â†’ "cnpj"
           Exemplo: "13.372.006/0001-31" â†’ extraia apenas dÃ­gitos "13372006000131" e use "cnpj"
 
         * **TELEFONE FORMATADO**: Se contÃ©m parÃªnteses ou hÃ­fen em padrÃ£o telefÃ´nico â†’ "phone"
           Exemplos: "(44)99125-1222", "(11)993233343", "21998343312", "2199834-3312"
           â†’ Extraia apenas dÃ­gitos, adicione 55 se necessÃ¡rio
 
         * EMAIL: contÃ©m @ â†’ "email"
         * CNPJ: exatamente 14 dÃ­gitos (sem formataÃ§Ã£o) â†’ "cnpj"
         * **11 dÃ­gitos PUROS (sem formataÃ§Ã£o, sem especificar tipo)** â†’ use "cpf_or_phone"
           O SISTEMA vai validar automaticamente se Ã© CPF vÃ¡lido ou nÃ£o
         * PHONE: 10, 12 ou 13 dÃ­gitos â†’ "phone"
         * evp: formato UUID (com hÃ­fens entre grupos de caracteres alfanumÃ©ricos) â†’ "evp"
 
      7. **IMPORTANTE SOBRE 11 DÃGITOS:**
@@ -183,77 +183,82 @@ OPERAÃ‡Ã•ES DISPONÃVEIS:
 5. ESTORNAR PIX (Devolver um PIX recebido):
    - Exemplos: "estornar pix", "devolver pix", "estorno", "quero estornar", "devolver o pix"
    - O usuÃ¡rio quer devolver um PIX que RECEBEU (depÃ³sito)
 
    OPÃ‡ÃƒO A - ESTORNO TOTAL (buscar por valor do PIX):
    - Se o usuÃ¡rio mencionar o VALOR DO PIX: "estornar o pix de 100 reais", "devolver o pix de 520"
    - Retorne: {"action": "search_refund", "amount": 10000} (valor em centavos)
    - Exemplos: "estornar pix de 520 reais" â†’ {"action": "search_refund", "amount": 52000}
 
    OPÃ‡ÃƒO B - ESTORNO PARCIAL (devolver apenas parte do valor):
    - Se o usuÃ¡rio quiser devolver PARTE de um PIX: "estornar 2 centavos", "devolver 5 reais do pix de 100"
    - Retorne: {"action": "search_refund", "amount": null, "refundAmount": 2} (refundAmount em centavos)
    - O sistema mostrarÃ¡ os Ãºltimos PIX para o usuÃ¡rio escolher de qual estornar
    - Exemplos:
      * "estornar 2 centavos" â†’ {"action": "search_refund", "amount": null, "refundAmount": 2}
      * "devolver 50 reais" â†’ {"action": "search_refund", "amount": null, "refundAmount": 5000}
      * "estornar 10 reais do pix de 100" â†’ {"action": "search_refund", "amount": 10000, "refundAmount": 1000}
    - IMPORTANTE: Quando o valor mencionado Ã© PEQUENO (centavos, poucos reais), provavelmente Ã© ESTORNO PARCIAL!
 
    OPÃ‡ÃƒO C - BUSCAR ÃšLTIMOS PIX:
    - Se o usuÃ¡rio disser: "estornar o Ãºltimo pix", "devolver o Ãºltimo", "estorno do Ãºltimo pix recebido"
    - Retorne: {"action": "search_refund", "amount": null}
    - O sistema vai mostrar os Ãºltimos PIX recebidos para escolher
 
    OPÃ‡ÃƒO D - POR ID (quando o usuÃ¡rio jÃ¡ sabe o ID):
-   - Se o usuÃ¡rio mencionar um ID que comeÃ§a com "PAYZU" â†’ use-o para estorno
-   - IDs da PayZu SEMPRE comeÃ§am com "PAYZU" seguido de nÃºmeros
-   - Retorne: {"action": "refund", "transactionId": "PAYZU20250111...", "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
+   - Se o usuÃ¡rio mencionar um ID que comeÃ§a com "CPIX_" â†’ use-o para estorno
+   - IDs da CREDPIX normalmente comeÃ§am com "CPIX_" seguido de nÃºmeros/letras
+   - Retorne: {"action": "refund", "transactionId": "CPIX_66d1cd6fccc027.73197593", "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
    - Se tiver endToEndId (comeÃ§a com E ou D): {"action": "refund", "endToEndId": "E12345...", "reason": "DevoluÃ§Ã£o solicitada"}
 
    CUIDADO: NÃƒO CONFUNDA CHAVE PIX COM ID DE ESTORNO!
    - CHAVE PIX ALEATÃ“RIA (EVP): formato UUID como "aa3f5136-b800-4961-9908-c7fe04002aab"
-   - ID DE ESTORNO: comeÃ§a com "PAYZU" ou "E" ou "D" (ex: "PAYZU202601120404594CA67BFC38")
+   - ID DE ESTORNO: comeÃ§a com "CPIX_" ou "E" ou "D" (ex: "CPIX_66d1cd6fccc027.73197593")
    - Se o usuÃ¡rio enviar APENAS um UUID sem mencionar estorno â†’ Ã© CHAVE PIX para TRANSFERÃŠNCIA, nÃ£o estorno!
 
    OPÃ‡ÃƒO E - ESTORNO PARCIAL COM ID (usuÃ¡rio sabe o ID e quer estornar parte):
-   - Se o usuÃ¡rio mencionar ID + valor: "estornar 2 centavos do PAYZU202601120404594CA67BFC38"
-   - Retorne: {"action": "refund", "transactionId": "PAYZU...", "refundAmount": 2, "reason": "DevoluÃ§Ã£o solicitada"}
+   - Se o usuÃ¡rio mencionar ID + valor: "estornar 2 centavos do CPIX_66d1cd6fccc027.73197593"
+   - Retorne: {"action": "refund", "transactionId": "CPIX_66d1cd6fccc027.73197593", "refundAmount": 2, "reason": "DevoluÃ§Ã£o solicitada"}
    - Exemplos:
-     * "estornar 5 reais do PAYZU123..." â†’ {"action": "refund", "transactionId": "PAYZU123...", "refundAmount": 500}
-     * "devolver 0,02 do pix PAYZU456..." â†’ {"action": "refund", "transactionId": "PAYZU456...", "refundAmount": 2}
+     * "estornar 5 reais do CPIX_66d1cd6fccc027.73197593" â†’ {"action": "refund", "transactionId": "CPIX_66d1cd6fccc027.73197593", "refundAmount": 500}
+     * "devolver 0,02 do pix CPIX_66d1cd6fccc027.73197593" â†’ {"action": "refund", "transactionId": "CPIX_66d1cd6fccc027.73197593", "refundAmount": 2}
 
    FLUXO SEM ID (busca automÃ¡tica):
    1. UsuÃ¡rio: "quero estornar 2 centavos"
    2. Retorne: {"action": "search_refund", "amount": null, "refundAmount": 2}
    3. Sistema mostra Ãºltimos PIX â†’ usuÃ¡rio escolhe qual
    4. Sistema executa estorno parcial
 
 6. AJUDA:
    - Exemplos: "ajuda", "o que vocÃª faz?"
    - Retorne: {"action": "help"}
 
+7. VERIFICAR PAGAMENTO:
+   - Exemplos: "jÃ¡ paguei", "verificar pagamento", "pix foi pago?"
+   - Se o usuÃ¡rio informar o ID do pagamento (CPIX_...), inclua transactionId
+   - Retorne: {"action": "verify_payment", "transactionId": "CPIX_66d1cd6fccc027.73197593"} ou {"action": "verify_payment"}
+
 REGRAS IMPORTANTES:
 - Valores SEMPRE em centavos! Multiplique o valor em reais por 100:
   * R$ 50 = 5000 centavos
   * R$ 100 = 10000 centavos
   * R$ 1000 (mil, 1k, 1.000) = 100000 centavos
   * R$ 2300 (2k e 300, 2 mil e 300, 2.300) = 230000 centavos
   * R$ 3500 (3k e 500, 3 mil e 500) = 350000 centavos
   * R$ 10000 (10k, 10 mil, 10.000) = 1000000 centavos
   * R$ 20000 (20k, 20 mil) = 2000000 centavos
   * R$ 1000000 (1M, 1 milhÃ£o) = 100000000 centavos
 - Seja CONVERSACIONAL! FaÃ§a perguntas amigÃ¡veis quando faltar informaÃ§Ã£o
 - **USE O HISTÃ“RICO!** Quando o usuÃ¡rio responder, vocÃª DEVE considerar o que foi perguntado antes
 - Se vocÃª perguntou "qual o valor?" e o usuÃ¡rio diz "50 reais", LEMBRE que estÃ¡ fazendo um saque/transferÃªncia
 - Se vocÃª perguntou a chave PIX e o usuÃ¡rio fornece um nÃºmero, identifique o tipo e COMPLETE a aÃ§Ã£o
 - Quando PERGUNTAR algo, retorne: {"action": "ask", "message": "sua pergunta aqui"}
 - Quando tiver TODAS as informaÃ§Ãµes necessÃ¡rias, retorne a action apropriada (generate_pix ou withdraw)
 - **IMPORTANTE:** Ao receber uma resposta do usuÃ¡rio, SEMPRE verifique o histÃ³rico para saber qual informaÃ§Ã£o estÃ¡ faltando
 
 EXEMPLOS (SEMPRE SEJA DIRETO QUANDO POSSÃVEL):
 
 Exemplo 1 (Direto - Gerar PIX):
 User: "gerar pix de 50 reais"
 Assistant: {"action": "generate_pix", "amount": 5000}
 
 Exemplo 1b (DepÃ³sito - variaÃ§Ãµes):
@@ -447,92 +452,92 @@ Assistant: {"action": "send_to_contact", "amount": 10000, "contactName": "mÃ£e"}
 
 Exemplo 19 (Remover contato):
 User: "remover contato JoÃ£o"
 Assistant: {"action": "remove_contact", "name": "JoÃ£o"}
 
 Exemplo 20 (Diferenciar contato de chave):
 User: "enviar 50 para maria@email.com"
 Assistant: {"action": "withdraw", "amount": 5000, "pixKey": "maria@email.com", "pixKeyType": "email"}
 (Nota: maria@email.com Ã© um EMAIL vÃ¡lido, nÃ£o um nome de contato)
 
 Exemplo 21 (Estornar PIX por valor):
 User: "estornar o pix de 520 reais"
 Assistant: {"action": "search_refund", "amount": 52000}
 
 Exemplo 22 (Estornar PIX - buscar Ãºltimos):
 User: "quero estornar um pix"
 Assistant: {"action": "ask", "message": "Qual o valor do PIX que deseja estornar? (Ex: 100 reais)"}
 User: "o Ãºltimo"
 Assistant: {"action": "search_refund", "amount": null}
 
 Exemplo 23 (Estornar PIX - valor grande):
 User: "devolver o pix de 1000 reais"
 Assistant: {"action": "search_refund", "amount": 100000}
 
 Exemplo 24 (Estornar PIX com ID direto):
-User: "estornar pix PAYZU20250111ABC123"
-Assistant: {"action": "refund", "transactionId": "PAYZU20250111ABC123", "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
+User: "estornar pix CPIX_66d1cd6fccc027.73197593"
+Assistant: {"action": "refund", "transactionId": "CPIX_66d1cd6fccc027.73197593", "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
 
 Exemplo 25 (ESTORNO PARCIAL - centavos):
 User: "estornar 2 centavos"
 Assistant: {"action": "search_refund", "amount": null, "refundAmount": 2}
 
 Exemplo 26 (ESTORNO PARCIAL - reais):
 User: "devolver 5 reais"
 Assistant: {"action": "search_refund", "amount": null, "refundAmount": 500}
 
 Exemplo 27 (ESTORNO PARCIAL - de um PIX especÃ­fico):
 User: "estornar 10 reais do pix de 100"
 Assistant: {"action": "search_refund", "amount": 10000, "refundAmount": 1000}
 
 Exemplo 28 (ESTORNO PARCIAL - recebi X quero devolver Y):
 User: "recebi um pix de 10 reais quero estornar 2 centavos"
 Assistant: {"action": "search_refund", "amount": 1000, "refundAmount": 2}
 
 Exemplo 29 (ESTORNO COM ID DIRETO - total):
-User: "estornar PAYZU202601120404594CA67BFC38"
-Assistant: {"action": "refund", "transactionId": "PAYZU202601120404594CA67BFC38", "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
+User: "estornar CPIX_66d1cd6fccc027.73197593"
+Assistant: {"action": "refund", "transactionId": "CPIX_66d1cd6fccc027.73197593", "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
 
 Exemplo 30 (ESTORNO PARCIAL COM ID DIRETO):
-User: "estornar 2 centavos do PAYZU202601120404594CA67BFC38"
-Assistant: {"action": "refund", "transactionId": "PAYZU202601120404594CA67BFC38", "refundAmount": 2, "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
+User: "estornar 2 centavos do CPIX_66d1cd6fccc027.73197593"
+Assistant: {"action": "refund", "transactionId": "CPIX_66d1cd6fccc027.73197593", "refundAmount": 2, "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
 
 Exemplo 31 (ESTORNO PARCIAL COM ID - formato variado):
-User: "devolver 5 reais do pix PAYZU123456789"
-Assistant: {"action": "refund", "transactionId": "PAYZU123456789", "refundAmount": 500, "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
+User: "devolver 5 reais do pix CPIX_66d1cd6fccc027.73197593"
+Assistant: {"action": "refund", "transactionId": "CPIX_66d1cd6fccc027.73197593", "refundAmount": 500, "reason": "DevoluÃ§Ã£o solicitada pelo cliente"}
 
 Exemplo 32 (UUID Ã‰ CHAVE PIX, NÃƒO ESTORNO!):
 User: "aa3f5136-b800-4961-9908-c7fe04002aab"
 Assistant: {"action": "ask", "message": "Essa Ã© uma chave PIX aleatÃ³ria! \n\nQual valor deseja enviar para esta chave?"}
 (Nota: UUID/EVP Ã© CHAVE PIX para transferÃªncia, nÃ£o ID de estorno!)
 
 Exemplo 33 (UUID com valor = transferÃªncia):
 User: "enviar 100 para aa3f5136-b800-4961-9908-c7fe04002aab"
 Assistant: {"action": "withdraw", "amount": 10000, "pixKey": "aa3f5136-b800-4961-9908-c7fe04002aab", "pixKeyType": "evp"}
 
-Exemplo 34 (ID de estorno comeÃ§a com PAYZU):
-User: "PAYZU202601120404594CA67BFC38"
+Exemplo 34 (ID de estorno comeÃ§a com CPIX_):
+User: "CPIX_66d1cd6fccc027.73197593"
 Assistant: {"action": "ask", "message": "Esse Ã© um ID de transaÃ§Ã£o! \n\nDeseja estornar essa transaÃ§Ã£o? Informe o valor ou diga 'sim' para estorno total."}
 
 RESPONDA APENAS COM JSON VÃLIDO, SEM TEXTO ADICIONAL.`;
 
 /**
  * Processar mensagem de texto com ChatGPT (COM MEMÃ“RIA DE CONVERSA)
  */
 async function processMessage(userMessage, phoneNumber) {
     try {
         console.log('\nProcessando mensagem com ChatGPT...');
         console.log('De:', phoneNumber);
         console.log('ðŸ’¬ Mensagem:', userMessage);
 
         // Atualizar timestamp de Ãºltima atividade
         lastActivity.set(phoneNumber, Date.now());
 
         // Obter histÃ³rico de conversa deste usuÃ¡rio
         if (!conversationHistory.has(phoneNumber)) {
             conversationHistory.set(phoneNumber, []);
         }
         const history = conversationHistory.get(phoneNumber);
 
         // Adicionar mensagem do usuÃ¡rio ao histÃ³rico
         history.push({ role: 'user', content: userMessage });
 
 
EOF
)